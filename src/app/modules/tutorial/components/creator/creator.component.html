<div class='container'>
  <section class='mt-3'>
    <mat-form-field (click)='fileInput.click()'>
      <input type='text' [value]='fileName' matInput placeholder='Wybierz zdjęcie' readonly accept='image/png'>
      <mat-icon matSuffix>attach_file</mat-icon>
    </mat-form-field>
    <input type='file' #fileInput (change)='onFileSelected($event)'>
    <div class='d-flex justify-content-end'>
      <button type='button' mat-raised-button color='primary' (click)='uploadFile()'>Dodaj zdjęcie</button>
    </div>
    <app-uploaded-images *ngIf='imageUrls.length > 0' [imageUrls]='imageUrls' (deleteImageUrl)='setActiveImagesUrls($event)'></app-uploaded-images>

    <form class='container login-form' [formGroup]='addTutorialForm' (ngSubmit)='onAddTutorial()'>
      <div class='form-input'>
        <mat-form-field appearance='fill'>
          <mat-label>Nazwa poradnika</mat-label>
          <input matInput [formControl]='controls.name'>
          <mat-error *ngIf='controls.name.invalid'>{{getErrorMessage(controls.name)}}</mat-error>
        </mat-form-field>
      </div>

      <div class='form-input'>
        <mat-form-field appearance='fill'>
          <mat-label>Krótki opis</mat-label>
          <input matInput [formControl]='controls.shortDescription'>
          <mat-error *ngIf='controls.shortDescription.invalid'>{{getErrorMessage(controls.shortDescription)}}</mat-error>
        </mat-form-field>
      </div>

      <div class='form-input'>
        <mat-form-field appearance='fill'>
          <mat-label>Czas przygotowania [w minutach]</mat-label>
          <input type='number' matInput [formControl]='controls.timeToPrepare'>
          <mat-error *ngIf='controls.timeToPrepare.invalid'>{{getErrorMessage(controls.timeToPrepare)}}</mat-error>
        </mat-form-field>
      </div>

      <div class='form-input'>
        <mat-form-field appearance='fill'>
          <mat-label>Poziom trudności [w skali od 1 do 5]</mat-label>
          <input type='number' matInput [formControl]='controls.difficulty'>
          <mat-error *ngIf='controls.difficulty.invalid'>{{getErrorMessage(controls.difficulty)}}</mat-error>
        </mat-form-field>
      </div>

      <angular-editor [formControl]='controls.shortDescription' [config]='config'></angular-editor>

      <div class='form-input mt-2'>
        <mat-form-field>
          <mat-label>Kategoria</mat-label>
          <mat-select [formControl]='controls.categoryShortId'>
            <mat-option value=''>-</mat-option>
            <mat-option *ngFor='let category of categories | async' [value]='category.shortId'>{{category.name}}</mat-option>
          </mat-select>
          <mat-error *ngIf='controls.categoryShortId.invalid'>{{getErrorMessage(controls.categoryShortId)}}</mat-error>
        </mat-form-field>
      </div>

      <div class='form-input mt-2'>
        <mat-form-field>
          <mat-label>Typ dania</mat-label>
          <mat-select [formControl]='controls.dishShortId'>
            <mat-option value=''>-</mat-option>
            <mat-option *ngFor='let dish of dishes | async' [value]='dish.shortId'>{{dish.name}}</mat-option>
          </mat-select>
          <mat-error *ngIf='controls.dishShortId.invalid'>{{getErrorMessage(controls.dishShortId)}}</mat-error>
        </mat-form-field>
      </div>

      <div [formArrayName]='"parameters"' *ngIf='parameters.controls.length > 0'>
        <p>Parametry:</p>
        <div *ngFor='let parameter of parameters.controls; let i = index; let first = first' [formGroupName]='i'>
          <div class='form-control-wrapper'>
            <div class='form-array-input'>
              <mat-form-field appearance='fill'>
                <mat-label>Nazwa parametru</mat-label>
                <input matInput [formControl]='parameters.at(i).controls.key'>
                <mat-error *ngIf='parameters.at(i).controls.key.invalid'>{{getErrorMessage(parameters.at(i).controls.key)}}</mat-error>
              </mat-form-field>
            </div>
            <div class='form-array-input'>
              <mat-form-field appearance='fill'>
                <mat-label>Wartość parametru</mat-label>
                <input matInput [formControl]='parameters.at(i).controls.value'>
                <mat-error *ngIf='parameters.at(i).controls.value.invalid'>{{getErrorMessage(parameters.at(i).controls.value)}}</mat-error>
                <mat-icon matSuffix matTooltip='Usuń parametr' (click)='deleteParameter(i)' *ngIf='!first'>delete</mat-icon>
              </mat-form-field>
            </div>
          </div>
        </div>
        <div class='d-flex justify-content-end my-3'>
          <button type='button' mat-raised-button color='primary' (click)='addParameter()'>Dodaj parametr</button>
        </div>
      </div>
      <div class='d-flex justify-content-end'>
        <button mat-raised-button color="primary" type='submit' [disabled]='addTutorialForm.invalid' >Dodaj poradnik</button>
      </div>
    </form>
    <mat-slide-toggle [(ngModel)]='hasMeat' class='mx-3'>Z mięsem: {{hasMeat}}</mat-slide-toggle>
    <mat-slide-toggle [(ngModel)]='isVeganRecipe' class='mx-3'>Wegańskie: {{isVeganRecipe}}</mat-slide-toggle>
    <mat-slide-toggle [(ngModel)]='isSweetRecipe' class='mx-3'>Na słodko: {{isSweetRecipe}}</mat-slide-toggle>
    <mat-slide-toggle [(ngModel)]='isSpicyRecipe' class='mx-3'>Na ostro: {{isSpicyRecipe}}</mat-slide-toggle>
  </section>
</div>
